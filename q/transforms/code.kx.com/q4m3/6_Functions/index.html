



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Q for Mortals">
      
      
        <link rel="canonical" href="../6_Functions.1">
      
      
        <meta name="author" content="Jeffry Borror">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>6. Functions - Q for Mortals</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="http://code.kx.com/stylesheets/prism.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="../6_Functions.1#6-functions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://code.kx.com/q4m3" title="Q for Mortals" class="md-header-nav__button md-logo">
          
            <img src="../img/qfm3.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Q for Mortals
              </span>
              <span class="md-header-nav__topic">
                6. Functions
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../img/qfm3.jpg" width="48" height="48">
      
    </span>
    Q for Mortals
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../redirect/index.html" title="code.kx.com" class="md-nav__link">
      code.kx.com
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Contents" class="md-nav__link">
      Contents
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../preface/index.html" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../0_Overview/index.html" title="0. Overview" class="md-nav__link">
      0. Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_Q_Shock_and_Awe.1" title="1. Q Shock and Awe" class="md-nav__link">
      1. Q Shock and Awe
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2_Basic_Data_Types_Atoms/index.html" title="2. Basic Data Types – Atoms" class="md-nav__link">
      2. Basic Data Types – Atoms
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3_Lists.1" title="3. Lists" class="md-nav__link">
      3. Lists
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../4_Operators.1" title="4. Operators" class="md-nav__link">
      4. Operators
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_Dictionaries.1" title="5. Dictionaries" class="md-nav__link">
      5. Dictionaries
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        6. Functions
      </label>
    
    <a href="../6_Functions.1" title="6. Functions" class="md-nav__link md-nav__link--active">
      6. Functions
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#60-overview" title="6.0 Overview" class="md-nav__link">
    6.0 Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#61-function-specification" title="6.1 Function Specification" class="md-nav__link">
    6.1 Function Specification
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#611-function-definition" title="6.1.1 Function Definition" class="md-nav__link">
    6.1.1 Function Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#612-function-notation-and-terminology" title="6.1.2 Function Notation and Terminology" class="md-nav__link">
    6.1.2 Function Notation and Terminology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#613-function-application" title="6.1.3 Function Application" class="md-nav__link">
    6.1.3 Function Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#614-functions-with-no-return-value" title="6.1.4 Functions with No Return Value" class="md-nav__link">
    6.1.4 Functions with No Return Value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#615-we-dont-need-no-stinkin-brackets" title="6.1.5 We Don't Need No Stinkin' Brackets" class="md-nav__link">
    6.1.5 We Don't Need No Stinkin' Brackets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#616-application-of-a-name" title="6.1.6 Application of a Name" class="md-nav__link">
    6.1.6 Application of a Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#617-implicit-parameters" title="6.1.7 Implicit Parameters" class="md-nav__link">
    6.1.7 Implicit Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#618-anonymous-functions-and-lambda-expressions" title="6.1.8 Anonymous Functions and Lambda Expressions" class="md-nav__link">
    6.1.8 Anonymous Functions and Lambda Expressions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#619-the-identity-function" title="6.1.9 The Identity Function ::" class="md-nav__link">
    6.1.9 The Identity Function ::
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#6110-functions-are-data" title="6.1.10 Functions Are Data" class="md-nav__link">
    6.1.10 Functions Are Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#62-call-by-name" title="6.2 Call-by-Name" class="md-nav__link">
    6.2 Call-by-Name
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#63-local-and-global-variables" title="6.3 Local and Global Variables" class="md-nav__link">
    6.3 Local and Global Variables
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#631-defining-local-and-global-variables" title="6.3.1 Defining Local and Global Variables" class="md-nav__link">
    6.3.1 Defining Local and Global Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#632-assigning-global-variables-within-a-function" title="6.3.2 Assigning Global Variables within a Function" class="md-nav__link">
    6.3.2 Assigning Global Variables within a Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#64-projection" title="6.4 Projection" class="md-nav__link">
    6.4 Projection
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#641-function-projection" title="6.4.1 Function Projection" class="md-nav__link">
    6.4.1 Function Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#642-operator-projection" title="6.4.2 Operator Projection" class="md-nav__link">
    6.4.2 Operator Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#643-multiple-projections" title="6.4.3 Multiple Projections" class="md-nav__link">
    6.4.3 Multiple Projections
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#65-everything-is-a-map" title="6.5 Everything Is a Map" class="md-nav__link">
    6.5 Everything Is a Map
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#651-similarity-of-notation" title="6.5.1 Similarity of Notation" class="md-nav__link">
    6.5.1 Similarity of Notation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#652-list-of-indices-keys-and-arguments" title="6.5.2 List of Indices, Keys and Arguments" class="md-nav__link">
    6.5.2 List of Indices, Keys and Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#653-indexing-at-depth" title="6.5.3 Indexing at Depth" class="md-nav__link">
    6.5.3 Indexing at Depth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#654-projection-and-index-elision" title="6.5.4 Projection and Index Elision" class="md-nav__link">
    6.5.4 Projection and Index Elision
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#655-out-of-bounds-index" title="6.5.5 Out of Bounds Index" class="md-nav__link">
    6.5.5 Out of Bounds Index
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#66-atomic-functions" title="6.6 Atomic Functions" class="md-nav__link">
    6.6 Atomic Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#661-monadic-atomic-functions-and-map" title="6.6.1 Monadic Atomic Functions and "map"" class="md-nav__link">
    6.6.1 Monadic Atomic Functions and "map"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#662-dyadic-atomic-functions-and-zip" title="6.6.2 Dyadic Atomic Functions and zip" class="md-nav__link">
    6.6.2 Dyadic Atomic Functions and zip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#663-creating-atomic-functions" title="6.6.3 Creating Atomic Functions" class="md-nav__link">
    6.6.3 Creating Atomic Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#67-adverbs" title="6.7 Adverbs" class="md-nav__link">
    6.7 Adverbs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#671-monadic-each" title="6.7.1 Monadic each" class="md-nav__link">
    6.7.1 Monadic each
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#672-each-both" title="6.7.2 each-both '" class="md-nav__link">
    6.7.2 each-both '
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#673-each-left" title="6.7.3 each-left \:" class="md-nav__link">
    6.7.3 each-left \:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#674-each-right" title="6.7.4 each-right /:" class="md-nav__link">
    6.7.4 each-right /:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#675-cross-product" title="6.7.5 Cross Product" class="md-nav__link">
    6.7.5 Cross Product
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#676-over-for-accumulation" title="6.7.6 Over (/) for Accumulation" class="md-nav__link">
    6.7.6 Over (/) for Accumulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#677-more-over-iteration" title="6.7.7 More Over: Iteration" class="md-nav__link">
    6.7.7 More Over: Iteration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#678-scan" title="6.7.8 Scan \" class="md-nav__link">
    6.7.8 Scan \
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#679-each-previous" title="6.7.9 each-previous (':)" class="md-nav__link">
    6.7.9 each-previous (':)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#68-general-application" title="6.8 General Application" class="md-nav__link">
    6.8 General Application
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#681-verb" title="6.8.1 Verb @" class="md-nav__link">
    6.8.1 Verb @
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#682-verb-dot" title="6.8.2 Verb Dot ." class="md-nav__link">
    6.8.2 Verb Dot .
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#683-general-form-of-verb-application" title="6.8.3 General Form of Verb Application" class="md-nav__link">
    6.8.3 General Form of Verb Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#684-general-apply-with-monadic-functions" title="6.8.4 General Apply (@) with Monadic Functions" class="md-nav__link">
    6.8.4 General Apply (@) with Monadic Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#685-general-apply-with-dyadic-functions" title="6.8.5 General Apply (@) with Dyadic Functions" class="md-nav__link">
    6.8.5 General Apply (@) with Dyadic Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#686-general-apply-for-monadic-functions" title="6.8.6 General Apply (.) for Monadic Functions" class="md-nav__link">
    6.8.6 General Apply (.) for Monadic Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#687-general-apply-for-dyadic-functions" title="6.8.7 General Apply (.) for Dyadic Functions" class="md-nav__link">
    6.8.7 General Apply (.) for Dyadic Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_Transforming_Data/index.html" title="7. Transforming Data" class="md-nav__link">
      7. Transforming Data
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../8_Tables.1" title="8. Tables" class="md-nav__link">
      8. Tables
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../9_Queries_q-sql.1" title="9. Queries – q-sql" class="md-nav__link">
      9. Queries – q-sql
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../10_Execution_Control/index.html" title="10. Execution Control" class="md-nav__link">
      10. Execution Control
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../11_IO.1" title="11. I/O" class="md-nav__link">
      11. I/O
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../12_Workspace_Organization.1" title="12. Workspace Organization" class="md-nav__link">
      12. Workspace Organization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../13_Commands_and_System_Variables.1" title="13. Commands and System Variables" class="md-nav__link">
      13. Commands and System Variables
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../14_Introduction_to_Kdb+.1" title="14. Introduction to Kdb+" class="md-nav__link">
      14. Introduction to Kdb+
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../A_Built-in_Functions.1" title="Appendix A. Built-in Functions" class="md-nav__link">
      Appendix A. Built-in Functions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../B_Error_Messages/index.html" title="Appendix B. Error Messages" class="md-nav__link">
      Appendix B. Error Messages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../colophon/index.html" title="Colophon" class="md-nav__link">
      Colophon
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#60-overview" title="6.0 Overview" class="md-nav__link">
    6.0 Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#61-function-specification" title="6.1 Function Specification" class="md-nav__link">
    6.1 Function Specification
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#611-function-definition" title="6.1.1 Function Definition" class="md-nav__link">
    6.1.1 Function Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#612-function-notation-and-terminology" title="6.1.2 Function Notation and Terminology" class="md-nav__link">
    6.1.2 Function Notation and Terminology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#613-function-application" title="6.1.3 Function Application" class="md-nav__link">
    6.1.3 Function Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#614-functions-with-no-return-value" title="6.1.4 Functions with No Return Value" class="md-nav__link">
    6.1.4 Functions with No Return Value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#615-we-dont-need-no-stinkin-brackets" title="6.1.5 We Don't Need No Stinkin' Brackets" class="md-nav__link">
    6.1.5 We Don't Need No Stinkin' Brackets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#616-application-of-a-name" title="6.1.6 Application of a Name" class="md-nav__link">
    6.1.6 Application of a Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#617-implicit-parameters" title="6.1.7 Implicit Parameters" class="md-nav__link">
    6.1.7 Implicit Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#618-anonymous-functions-and-lambda-expressions" title="6.1.8 Anonymous Functions and Lambda Expressions" class="md-nav__link">
    6.1.8 Anonymous Functions and Lambda Expressions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#619-the-identity-function" title="6.1.9 The Identity Function ::" class="md-nav__link">
    6.1.9 The Identity Function ::
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#6110-functions-are-data" title="6.1.10 Functions Are Data" class="md-nav__link">
    6.1.10 Functions Are Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#62-call-by-name" title="6.2 Call-by-Name" class="md-nav__link">
    6.2 Call-by-Name
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#63-local-and-global-variables" title="6.3 Local and Global Variables" class="md-nav__link">
    6.3 Local and Global Variables
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#631-defining-local-and-global-variables" title="6.3.1 Defining Local and Global Variables" class="md-nav__link">
    6.3.1 Defining Local and Global Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#632-assigning-global-variables-within-a-function" title="6.3.2 Assigning Global Variables within a Function" class="md-nav__link">
    6.3.2 Assigning Global Variables within a Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#64-projection" title="6.4 Projection" class="md-nav__link">
    6.4 Projection
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#641-function-projection" title="6.4.1 Function Projection" class="md-nav__link">
    6.4.1 Function Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#642-operator-projection" title="6.4.2 Operator Projection" class="md-nav__link">
    6.4.2 Operator Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#643-multiple-projections" title="6.4.3 Multiple Projections" class="md-nav__link">
    6.4.3 Multiple Projections
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#65-everything-is-a-map" title="6.5 Everything Is a Map" class="md-nav__link">
    6.5 Everything Is a Map
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#651-similarity-of-notation" title="6.5.1 Similarity of Notation" class="md-nav__link">
    6.5.1 Similarity of Notation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#652-list-of-indices-keys-and-arguments" title="6.5.2 List of Indices, Keys and Arguments" class="md-nav__link">
    6.5.2 List of Indices, Keys and Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#653-indexing-at-depth" title="6.5.3 Indexing at Depth" class="md-nav__link">
    6.5.3 Indexing at Depth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#654-projection-and-index-elision" title="6.5.4 Projection and Index Elision" class="md-nav__link">
    6.5.4 Projection and Index Elision
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#655-out-of-bounds-index" title="6.5.5 Out of Bounds Index" class="md-nav__link">
    6.5.5 Out of Bounds Index
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#66-atomic-functions" title="6.6 Atomic Functions" class="md-nav__link">
    6.6 Atomic Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#661-monadic-atomic-functions-and-map" title="6.6.1 Monadic Atomic Functions and "map"" class="md-nav__link">
    6.6.1 Monadic Atomic Functions and "map"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#662-dyadic-atomic-functions-and-zip" title="6.6.2 Dyadic Atomic Functions and zip" class="md-nav__link">
    6.6.2 Dyadic Atomic Functions and zip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#663-creating-atomic-functions" title="6.6.3 Creating Atomic Functions" class="md-nav__link">
    6.6.3 Creating Atomic Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#67-adverbs" title="6.7 Adverbs" class="md-nav__link">
    6.7 Adverbs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#671-monadic-each" title="6.7.1 Monadic each" class="md-nav__link">
    6.7.1 Monadic each
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#672-each-both" title="6.7.2 each-both '" class="md-nav__link">
    6.7.2 each-both '
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#673-each-left" title="6.7.3 each-left \:" class="md-nav__link">
    6.7.3 each-left \:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#674-each-right" title="6.7.4 each-right /:" class="md-nav__link">
    6.7.4 each-right /:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#675-cross-product" title="6.7.5 Cross Product" class="md-nav__link">
    6.7.5 Cross Product
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#676-over-for-accumulation" title="6.7.6 Over (/) for Accumulation" class="md-nav__link">
    6.7.6 Over (/) for Accumulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#677-more-over-iteration" title="6.7.7 More Over: Iteration" class="md-nav__link">
    6.7.7 More Over: Iteration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#678-scan" title="6.7.8 Scan \" class="md-nav__link">
    6.7.8 Scan \
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#679-each-previous" title="6.7.9 each-previous (':)" class="md-nav__link">
    6.7.9 each-previous (':)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="../6_Functions.1#68-general-application" title="6.8 General Application" class="md-nav__link">
    6.8 General Application
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#681-verb" title="6.8.1 Verb @" class="md-nav__link">
    6.8.1 Verb @
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#682-verb-dot" title="6.8.2 Verb Dot ." class="md-nav__link">
    6.8.2 Verb Dot .
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#683-general-form-of-verb-application" title="6.8.3 General Form of Verb Application" class="md-nav__link">
    6.8.3 General Form of Verb Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#684-general-apply-with-monadic-functions" title="6.8.4 General Apply (@) with Monadic Functions" class="md-nav__link">
    6.8.4 General Apply (@) with Monadic Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#685-general-apply-with-dyadic-functions" title="6.8.5 General Apply (@) with Dyadic Functions" class="md-nav__link">
    6.8.5 General Apply (@) with Dyadic Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#686-general-apply-for-monadic-functions" title="6.8.6 General Apply (.) for Monadic Functions" class="md-nav__link">
    6.8.6 General Apply (.) for Monadic Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="../6_Functions.1#687-general-apply-for-dyadic-functions" title="6.8.7 General Apply (.) for Dyadic Functions" class="md-nav__link">
    6.8.7 General Apply (.) for Dyadic Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="6-functions">6. Functions<a class="headerlink" href="../6_Functions.1#6-functions" title="Permanent link">&para;</a></h1>
<h2 id="60-overview">6.0 Overview<a class="headerlink" href="../6_Functions.1#60-overview" title="Permanent link">&para;</a></h2>
<p>In this chapter, we cover functions in depth. Before diving in, you may wish to review the <a href="../0_Overview/index.html#02-mathematics-refresher">Mathematics Refresher</a> in Chapter 0 for the approach and terminology we adopt.</p>
<p>We describe various built-in functions along the way in this tutorial. Sometimes we shall use a built-in function with minimal explanation; simply look it up in <a href="../A_Built-in_Functions.1">Appendix A</a>, which contains specifics and examples of nearly all the q built-in functions.</p>
<h2 id="61-function-specification">6.1 Function Specification<a class="headerlink" href="../6_Functions.1#61-function-specification" title="Permanent link">&para;</a></h2>
<p>The notion of a function in q corresponds to a (mathematical) map that is specified by an algorithm. A <em>function</em> is a sequence of expressions to be evaluated, having optional input parameters and a return value. <em>Application</em> of a function is the process of evaluating the expressions in sequence, substituting actual arguments for any formal parameters. The result of the evaluation, should there be one, is the function's output value.</p>
<p>Because a q function can modify global variables, q is not a pure functional language. A mathematical function can never reach outside its own body and have side effects. You should minimize such behavior for code maintainability.</p>
<h3 id="611-function-definition">6.1.1 Function Definition<a class="headerlink" href="../6_Functions.1#611-function-definition" title="Permanent link">&para;</a></h3>
<p>The syntax of function definition is a matching pair of braces <code>{</code> and <code>}</code> enclosing (optional) parameters followed by a sequence of expressions. In contrast to statically typed languages, the input parameters and the return value are not explicitly typed; in fact, they don't even need to be declared. Even the function name is optional.</p>
<p>Following is a full specification of a function that squares its input. In this case, the function simply returns the value of the (last) expression evaluated. We add optional whitespace after the parameter declaration for readability.</p>
<pre><code class="q">q){[x] x*x}
</code></pre>

<p>Apply this function by following it with an argument enclosed in square brackets. This causes the supplied argument to be substituted for all occurrences of the parameter <code>x</code>, the expression to be evaluated and the result returned as the output value.</p>
<pre><code class="q">q){[x] x*x}[3]
9
</code></pre>

<p>A function is a first-class value – i.e., it is data just like a long or float. In particular, a function can be assigned to a variable, whereupon it acquires a name. This variable can be used in place of the function.</p>
<pre><code class="q">q)f:{[x] x*x}
q)f[3]
_
</code></pre>

<h3 id="612-function-notation-and-terminology">6.1.2 Function Notation and Terminology<a class="headerlink" href="../6_Functions.1#612-function-notation-and-terminology" title="Permanent link">&para;</a></h3>
<p>The formal notation for function definition is,</p>
<p>{[p<sub>1</sub>;...;p<sub>n</sub>] e<sub>1</sub>; ...; e<sub>m</sub>}</p>
<p>The optional p<sub>1</sub>, ... , p<sub>n</sub> are formal parameters. The expressions <em>e<sub>1</sub></em>, ... , <em>e<sub>m</sub></em> – which presumably involve the parameters – represent the steps of an algorithm that are evaluated in order. Note that while the expressions are sequenced left-to-right, an individual expression is always evaluated right-to-left.</p>
<p>For readability, in this text we shall normally insert optional whitespace after the square bracket that closes the parameter list, as well as after each semi-colon separator. Other styles may differ.</p>
<div class="admonition tip">
<p class="admonition-title">Semi-colons</p>
<p>The semi-colons in the body are separators, not terminators. Do not place a semi-colon after the last expression unless you deliberately want to suppress the return value.</p>
<p>In fact, <code>;</code> is an operator that evaluates its left operand and discards the result, then evaluates the right operand and returns that value. If you meditate on this, you will realize that this is precisely the behavior of the semi-colon separators in a function body.
<pre><code class="language-q">
q)a:2*3;6*7
42
q)a
6
</code></pre></p>
</div>
<p>The number of formal input parameters (implicit or explicit) is the function <em>valence</em>. Most common are <em>monadic</em> (valence 1) and <em>dyadic</em> (valence 2).</p>
<p>A <em>niladic</em> function in q is a function that has no meaningful input. This is similar to a function taking <code>void</code> in C. In functional programming this is represented as a function defined on a type called "unit" having a single value, often written <code>()</code>. In q it is written with an empty parameter declaration,</p>
<pre><code class="q">f:{[] … }
</code></pre>

<p>and is applied with empty argument – i.e., <code>f[]</code>. In this case, the function either returns a constant or has <em>side effects</em>, meaning that it accesses resources outside its body.</p>
<pre><code class="q">q){[] 42} / pure function returns constant 42
_
q){[] a*a} / impure function: references global a
_
</code></pre>

<p>The maximum valence permitted as of this writing (Sep 2015) is 8; specifying more than eight parameters will cause an error. You can circumvent this restriction by encapsulating multiple parameters in a list or dictionary.</p>
<p>The output value of a function written in functional programming style is the value of the last expression in its body. This is the recommended style of writing q since it results in linear flow that is easy to follow and debug.</p>
<pre><code class="q">q){[x] x*x}
q){[x;y] a:x*x; b:y*y; r:a+b; r}
</code></pre>

<p>This convention can be supplanted by using a monadic overload of <code>:</code> that immediately terminates function evaluation and returns the value of the expression to its right. This style is discouraged.</p>
<pre><code class="q">q){[x] :x*x} / unnecessary use of :
q){[x] a:1; :x*x; b:3} / dead code
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Keep it short</p>
<p>Q functions should be compact and modular: each function should perform a well-defined unit of work. Due to the power of q operators and built-in functions, many functions are one line. </p>
<p>When a function exceeds 20 statements, you should look to refactor it.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Ambivalence</p>
<p>When Arthur Whitney, the creator of q, says that q is not ambivalent, he doesn't mean that q is decisive. Rather, in contrast to k, q operators and built-in functions are <em>not</em> overloaded on valence, meaning that the same function does not have different behavior in a monadic and dyadic form. That said, q operators and built-in functions <em>are</em> overloaded on just about anything else, including the type, sign or rank of arguments – sometimes multiply so.</p>
</div>
<h3 id="613-function-application">6.1.3 Function Application<a class="headerlink" href="../6_Functions.1#613-function-application" title="Permanent link">&para;</a></h3>
<p>The notation for function application parallels that of the formal parameters in its definition. The function is followed by square brackets enclosing arguments separated by semi-colons. Application causes the expressions in the function body to be evaluated in sequence, substituting the value of each argument for the corresponding formal parameter.</p>
<pre><code class="q">q){[x] x*x}[3]
9
q)f:{[x] x*x}
q)f[4]
_
q){[x;y] x+y}[3;4]
7
q)g:{[x;y] x+y}
q)g[3;4]
_
</code></pre>

<p>Function application in q is <em>strict</em>, meaning that expressions in arguments are evaluated <strong>before</strong> substitution is performed.</p>
<pre><code class="q">q)f:{[x] x*x}
q)f[0N!3+1]
4
16
</code></pre>

<p>The valence of a function is also called its <em>rank</em>. An application with too many arguments generates a <code>'rank</code> error. This doesn't mean your code stinks, although it might.</p>
<pre><code class="q">q) {[x] x*x}[3;4]
'rank
</code></pre>

<p>Apply a niladic function with no arguments or with an arbitrary argument, which is ignored.</p>
<pre><code class="q">q)const42:{[] 42}
q)const42[]
_
q)const42[98.6]
_
</code></pre>

<h3 id="614-functions-with-no-return-value">6.1.4 Functions with No Return Value<a class="headerlink" href="../6_Functions.1#614-functions-with-no-return-value" title="Permanent link">&para;</a></h3>
<p>Every q function has a return value but sometimes the value carries no meaningful information – i.e., it is used purely for side effects. For example, it may send off a message asynchronously without waiting for an acknowledgement of receipt or it may update a global table. To achieve the equivalent of a <code>void</code> return in C, make the expression after the last semi-colon in the function body empty.</p>
<pre><code class="q">q)fvoid:{[x] `a set x;}
q)fvoid 42
q)
</code></pre>

<p>In fact, the actual return value is the nil item <code>::</code> that is a stand-in for <code>void</code> in this situation. Its display is suppressed in the q console but it can be revealed.</p>
<pre><code class="q">q)-3!fvoid 42
&quot;::&quot;
</code></pre>

<div class="admonition warning">
<p class="admonition-title">Semi-colon terminators</p>
<p>A common error made by qbies is to use semi-colons in a function body as expression terminators rather than as separators. This effectively makes the function return nil since the last expression is empty.</p>
</div>
<h3 id="615-we-dont-need-no-stinkin-brackets">6.1.5 We Don't Need No Stinkin' Brackets<a class="headerlink" href="../6_Functions.1#615-we-dont-need-no-stinkin-brackets" title="Permanent link">&para;</a></h3>
<p>There is an alternative notation for application of monadic functions (only) that dispenses with brackets. Simply separate the function from its argument with whitespace – customarily a single blank.</p>
<pre><code class="q">q){[x] 2*x} 42
84
q)f:{[x] x*x}
q)f 5
_
</code></pre>

<p>This convention for function application is called <em>juxtaposition</em> and is the norm in functional programming. While it may be jarring for newcomers, the decrease in superfluous punctuation – i.e., program noise – is worth the effort.</p>
<h3 id="616-application-of-a-name">6.1.6 Application of a Name<a class="headerlink" href="../6_Functions.1#616-application-of-a-name" title="Permanent link">&para;</a></h3>
<p>When a function has been assigned to a global variable, it can be applied by name – i.e., use the symbol name of the variable in place of the variable itself.</p>
<pre><code class="q">q)f:{x*x}
q)f[5]
_
q)`f[5]
25
q)`f 5
_
q).my.name.space.f:{2*x}
q)`.my.name.space.f[5]
_
</code></pre>

<p>This works because a global variable is implemented as a symbolic-name/function pair in a dictionary. Referring to the variable is actually lookup-by-name. Consequently application by name does <strong>not</strong> work for local variables or q system variables.</p>
<div class="admonition warning">
<p class="admonition-title">Application and call-by-name</p>
<p>Do not confuse application using the function name with call-by-name in which parameters are passed by name.</p>
</div>
<h3 id="617-implicit-parameters">6.1.7 Implicit Parameters<a class="headerlink" href="../6_Functions.1#617-implicit-parameters" title="Permanent link">&para;</a></h3>
<p>If, like mathematicians, you are satisfied with generic parameters <em>x</em>, <em>y</em> and <em>z</em>, you can omit the formal parameters and their brackets. Three implicit positional parameters <code>x</code>, <code>y</code> and <code>z</code> are automatically defined and available in a function’s expressions when no parameters are explicitly declared. Thus, the following two specifications result in equivalent input-output relations.</p>
<pre><code class="q">{[x] x*x}
{x*x}
</code></pre>

<p>As do,</p>
<pre><code class="q">{[x;y] x+y}
{x+y}
</code></pre>

<div class="admonition note">
<p class="admonition-title">Implicit arguments</p>
<p>When using implicit parameters, <code>x</code> is always substituted by the first actual argument, <code>y</code> the second and <code>z</code> the third.</p>
</div>
<p>The following function <code>f</code> only evaluates partially unless it is called with three parameters.</p>
<pre><code class="q">q)g:{x+z}  / likely meant x+y; requires 3 args in call
q)g[1;2]   / still waiting for 3rd arg – i.e., a projection
{x+z}[1;2]
q)g[1;2;3] / 2nd arg is required but ignored
4
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Only use the names <code>x</code>, <code>y</code> and <code>z</code> for the first three parameters of a function, either explicit or implicit.</p>
<p>Any other use leads down the path to perdition.
<pre><code class=:language-q">
q)evil:{[y;z;x] ...} / don't do this!
</code></pre></p>
</div>
<h3 id="618-anonymous-functions-and-lambda-expressions">6.1.8 Anonymous Functions and Lambda Expressions<a class="headerlink" href="../6_Functions.1#618-anonymous-functions-and-lambda-expressions" title="Permanent link">&para;</a></h3>
<p>Many traditional programming languages include the function name as part of its definition. A function without a name is then called an <em>anonymous</em> function. In functional programming, functions are all anonymous and are called <em>lambda expressions</em> or <em>lambdas</em> for short. All q functions are anonymous until assigned to a variable. Incidentally, the term “lambda” actually arose from a typesetting error in Church’s early work on what became known as the <em>lambda calculus</em>.</p>
<p>An anonymous function can be useful as an in-line macro where it would otherwise be awkward to substitute. For example,</p>
<pre><code class="q">f{[...] ...; {...}[...]; ...}
</code></pre>

<p>It is arguably more readable to factor this out.</p>
<p>Another use for anonymous functions is a rudimentary form of dynamic dispatch, in which functions are placed in a collection (e.g., list, dictionary, table) and then selected dynamically (i.e., at runtime) rather than by an intrinsic name.</p>
<pre><code class="q">q)powers:({1}; {x}; {x*x}; {x*x*x})
…
q)selected:2
q)powers[selected]
{x*x}
</code></pre>

<h3 id="619-the-identity-function">6.1.9 The Identity Function <code>::</code><a class="headerlink" href="../6_Functions.1#619-the-identity-function" title="Permanent link">&para;</a></h3>
<p>When <code>::</code> is used with function application syntax, it is the identity function – i.e., it returns its input as output.</p>
<p>The naked identity function cannot be used with juxtaposition; it must be enclosed in parentheses.</p>
<pre><code class="q">q)::[42]
_
q)::[`a`b`c]
_
q):: 42 / error
'
q)(::) 42
_
</code></pre>

<h3 id="6110-functions-are-data">6.1.10 Functions Are Data<a class="headerlink" href="../6_Functions.1#6110-functions-are-data" title="Permanent link">&para;</a></h3>
<p>The q data entities we have met until now are atoms (of various types), lists and dictionaries. For those new to functional programming, it may come as a surprise that functions are also data. A function can be passed around just like a long or float – e.g., as an item in a list.</p>
<pre><code class="q">q(1; 98.6; {x*x})
_
q)f:{x*x}
q)(f; neg)
_
q)(f; neg)[0]
q)(f; neg)[1; 5]
_
</code></pre>

<p>A function can also be used as the input or output value of another function. For example, here is a function that expects a function and a value and applies the function to the value.</p>
<pre><code class="q">q)apply:{x y}
q)sq:{x*x}
q)apply[sq; 5]
_
</code></pre>

<p>A function that operates on other functions is called a <em>higher-order function</em>. Higher-order functions are a powerful concept from functional programming. The derivative and indefinite integral are higher-order functions in elementary calculus.</p>
<h2 id="62-call-by-name">6.2 Call-by-Name<a class="headerlink" href="../6_Functions.1#62-call-by-name" title="Permanent link">&para;</a></h2>
<p>Ordinary function application in q uses call-by-value, meaning that arguments are reduced to values at the start of application. In the process, copies are made so that any original values are undisturbed. When the size of the input data is large, this copy may be prohibitive. In this case, there is an alternative method of application, <em>call-by-name</em>, in which names of (global) variables are passed instead of their values.</p>
<p>There is no special syntax for call-by-name in q. Instead, the function implementation simply expects a symbol containing the name of a variable and handles it appropriately. One example of a function that uses call-by-name is the built-in function <code>get</code>, which returns the value of the global variable whose name is passed.</p>
<pre><code class="q">q)a:42
q)get `a
42
</code></pre>

<p>Another example is dyadic <code>set</code>, which does the actual work of global assignment. It expects the name of a global variable and the value to be assigned.</p>
<pre><code class="q">q)`a set 43
`a
q)a
43
</code></pre>

<p>The result of any built-in call-by-name function application is the symbol that was passed as input. This enables call-by-name functions to be chained – i.e., composed.</p>
<div class="admonition warning">
<p class="admonition-title">Return values and error messages</p>
<p>Do not confuse the return value of call-by-name with an error message. The former begins with a back-tick whereas the latter begins with tick.</p>
</div>
<h2 id="63-local-and-global-variables">6.3 Local and Global Variables<a class="headerlink" href="../6_Functions.1#63-local-and-global-variables" title="Permanent link">&para;</a></h2>
<h3 id="631-defining-local-and-global-variables">6.3.1 Defining Local and Global Variables<a class="headerlink" href="../6_Functions.1#631-defining-local-and-global-variables" title="Permanent link">&para;</a></h3>
<p>A variable that is assigned with <code>:</code> within a function body is called a <em>local</em> variable. For example, a is a local variable in the following function.</p>
<pre><code class="q">q)f:{a:42; a+x}
</code></pre>

<div class="admonition note">
<p class="admonition-title">Maximum number of local variables</p>
<p>As of this writing (Sep 2015), the maximum number of local variables permitted in a function is 24.</p>
</div>
<p>Some notes on local variables:</p>
<ul>
<li>A local variable exists only for the duration of an application. There is no notion of a static local variable that maintains its value across applications.</li>
<li>A local variable is not visible outside its immediate scope of definition.</li>
<li>A local variable cannot be used as an argument to a q function that uses call-by-name.</li>
<li>
<p>A local variable is not visible within the body of a local function defined in the same scope. Otherwise put,</p>
<p><strong>q does <em>not</em> have lexical scoping</strong>.</p>
</li>
</ul>
<p>Here is a simple example demonstrating the lack of lexical scoping and its consequence. The function <code>f</code> defines a local variable <code>a</code> and a local function <code>helper</code>. In functional programming languages, the variable <code>a</code> is accessible throughout its scope of definition, which is the body of <code>f</code>. In particular, the variable <code>a</code> would be accessible within the body of <code>helper</code>.</p>
<pre><code class="q">q)f:{[p1] a:42; helper:{[p2] a*p2}; helper p1}
</code></pre>

<p>In q it is not. Nasty surprise!</p>
<pre><code class="q">q)f 5
{[p2] a*p2}
'a
</code></pre>

<p>Instead, you must declare an additional parameter in the local functions and pass the local variable as an argument. Projection provides a relatively clean way to do this.</p>
<pre><code class="q">q)f:{[p1] a:42; helper:{[a; p2] a*p2}[a;]; helper p1}
q)f 5
210
</code></pre>

<p>A variable assigned outside any function definition is called a <em>global</em> variable. Global variables are visible inside any function body.</p>
<pre><code class="q">q)b:7
q)f:{b*x}
q)f[6]
_
</code></pre>

<div class="admonition note">
<p class="admonition-title">Maximum number of global variables</p>
<p>As of this writing (Sep 2015), the maximum number of global variables that can be referenced in a function is 32. If this is a problem, redesign your code. For example collect values in a list or dictionary and pass that; the dictionary essentially provides pass-by-name.</p>
</div>
<h3 id="632-assigning-global-variables-within-a-function">6.3.2 Assigning Global Variables within a Function<a class="headerlink" href="../6_Functions.1#632-assigning-global-variables-within-a-function" title="Permanent link">&para;</a></h3>
<p>Although functional programming purists will cringe, you can assign a global within a function body. Some q programmers mistakenly use double colon <code>::</code>, which works provided there is no local variable with the same name.</p>
<pre><code class="q">q)b:6
q)f:{b::7; x*b}
q)f[6]
42
q)b
7
</code></pre>

<p>This usage of <code>::</code> is analogous to other forms of <em>amend-in-place</em>, such as <code>+:</code> or <code>,:</code>, but using the assignment operator itself <code>:</code>. This accounts for its somewhat unintuitive properties – it is not truly a global assignment operator.</p>
<p>If there is a local variable having the same name as the global you intend to assign, double-colon assigns the <strong>local</strong>, not the global.</p>
<pre><code class="q">q)b:6
q)f:{b:42; b::x; b}
q)f[98]
98
q)b
6
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Global assignment</p>
<p>We recommend against <code>::</code> for global assignment. Instead, use <code>set</code> which truly does global assignment and doesn't get hung up on a local-global name collision.</p>
<p>As we saw earlier, <code>set</code> uses call-by-name.
<pre><code class="language-q">
q)a:42
q)f:{a:98.6; `a set x}
q)f 43
`a
q)a
43
</code></pre></p>
</div>
<h2 id="64-projection">6.4 Projection<a class="headerlink" href="../6_Functions.1#64-projection" title="Permanent link">&para;</a></h2>
<p>Projection means specifying only some of the parameters in function application, resulting in a function of the remaining parameters.</p>
<h3 id="641-function-projection">6.4.1 Function Projection<a class="headerlink" href="../6_Functions.1#641-function-projection" title="Permanent link">&para;</a></h3>
<p>In some circumstances, a portion of the arguments to a multivalent function may be fixed while the remaining arguments vary. A common example is where a date is the last parameter and you apply the function for many dates keeping all other inputs fixed. In this situation, you can specify the fixed arguments and leave the others for later. This is called <em>projecting</em> the function onto the remaining arguments. Notationally, projection is a partial application in which some arguments are supplied and the others are omitted – i.e., nothing is in those slots.</p>
<p>For example, a homegrown dyadic function that adds its arguments can be projected onto the second parameter by providing just the first argument.</p>
<pre><code class="q">q)add:{x+y}
q)add[42;]
{x+y}[42;]
</code></pre>

<p>You can see from the console that q views the projection as a partial application that awaits its remaining argument(s). The projected function is a legitimate monadic function, which adds its input to the constant 42.</p>
<pre><code class="q">q)add[42;][3]
45
</code></pre>

<p>Since functions are first class, we can assign a projection to a variable and then apply it, none the wiser of its origin.</p>
<pre><code class="q">q)g:add[42;]
q)g[3]
_
</code></pre>

<p>Projection is related to <em>currying</em> in functional programming (named after Haskell Curry who did important early work on the theory of combinators). Both provide realizations of the mathematical observation that a function of two parameters is equivalent to a function of the first parameter that returns a function of the second parameter. This extends to multiple parameters as well. In q you simply project out successive parameters.</p>
<pre><code class="q">q)add3:{x+y+z}
q)add3[2][3][4]
9
</code></pre>

<p>Here we can view the result of <code>add3</code> applied to 2 as a function that when applied to 3 returns a function that when applied to 4 yields <code>add[2;3;4]</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Style recommendation</p>
<p>We recommend that you do <em>not</em> omit trailing semi-colons in projections, as this can obscure the intent of code. For example, if you came upon the following while reading q code, how would you know that <code>mystery</code> is actually a dyadic function unless you saw the comment line?
<pre><code class="language-q">
q)mystery:f[2] / surprise! f is actually f:{x+y+z}
</code></pre></p>
</div>
<p>The brackets denoting a function projection are required, but the additional brackets in a monadic projection's application can be omitted using juxtaposition as with any function.</p>
<pre><code class="q">q){x+y}[42;][3]
_
q){x+y}[42;] 3
_
</code></pre>

<p>Choice of notation is a matter of coding style. Some coders have good style; many do not.</p>
<div class="admonition warning">
<p class="admonition-title">No second look</p>
<p>The function body in a projection is captured at the time it is first encountered by the interpreter.</p>
<p>Thus if the underlying function is subsequently changed, the projection is not.
<pre><code class="language-q">
q)f:{x-y}
q)g:f[42;]
q)g
{x-y}[42;]
q)g[6]
<em>
q)f:{x+y}
q)g
</em>
q)g[6]
_
</code></pre></p>
</div>
<h3 id="642-operator-projection">6.4.2 Operator Projection<a class="headerlink" href="../6_Functions.1#642-operator-projection" title="Permanent link">&para;</a></h3>
<p>When used in infix form, a q operator can be projected by fixing its left operand (only). This requires parentheses. For example, the projection of <code>*</code> onto its right operand is,</p>
<pre><code class="q">q)(7*) 6
42
</code></pre>

<p>Due to the overloading of parentheses in q, an operator cannot be projected by fixing its right argument, since this would lead to notational ambiguity. For example, <code>-42</code> can only be the atom -42 and not a projection.</p>
<p>Nonetheless, every operator is a function, so you can project it in prefix form.</p>
<pre><code class="q">q)-[;42] 98
_
</code></pre>

<p>The whitespace is actually not necessary in juxtaposition here since the brackets make things unambiguous.</p>
<pre><code class="q">q)(7*)6
_
q)-[;42]98
_
</code></pre>

<p>Such notation is an acquired taste not shared by the author.</p>
<h3 id="643-multiple-projections">6.4.3 Multiple Projections<a class="headerlink" href="../6_Functions.1#643-multiple-projections" title="Permanent link">&para;</a></h3>
<p>Functions having valence greater than two can be projected in multiple ways. For example, a function of valence three can be projected onto the second parameter by specifying the first and third. The result is a monadic function of the second parameter only.</p>
<pre><code class="q">q){x+y+z}[1;;3]
{x+y+z}[1;;3]
q){x+y+z}[1;;3] 2
6
</code></pre>

<p>We could arrive at the same result in two steps.</p>
<ul>
<li><em>Step 1</em>: Project onto the second and third parameters by specifying just the first argument. This yields a dyadic function.</li>
</ul>
<pre><code class="q">q){x+y+z}[1;;]
{x+y+z}[1;;]
q){x+y+z}[1;;][2;3]
_
</code></pre>

<ul>
<li><em>Step two</em>: Project the resulting dyadic function onto its first parameter by providing only the second.</li>
</ul>
<pre><code class="q">q){x+y+z}[1;;][;3]
{x+y+z}[1;;][;3]
q){x+y+z}[1;;][;3] 2
_
</code></pre>

<p>This is equivalent to projecting in the reverse order.</p>
<pre><code class="q">q){x+y+z}[;;3][1;]
{x+y+z}[;;3][1;]
q){x+y+z}[;;3][1;] 2
_
</code></pre>

<h2 id="65-everything-is-a-map">6.5 Everything Is a Map<a class="headerlink" href="../6_Functions.1#65-everything-is-a-map" title="Permanent link">&para;</a></h2>
<p>Here we explore the deep relationship between q data structures and functions. While this section can be skipped on first reading, that would be like not eating your vegetables when you were a kid.</p>
<h3 id="651-similarity-of-notation">6.5.1 Similarity of Notation<a class="headerlink" href="../6_Functions.1#651-similarity-of-notation" title="Permanent link">&para;</a></h3>
<p>You have no doubt noticed that the notation for list indexing, dictionary lookup and monadic function application are identical. Namely,</p>
<pre><code class="q">q)L:0 1 4 9 16 25 36
q)f:{x*x}
q)L[2]
_
q)L 2
_
q)f[2]
_
q)f 2
_
</code></pre>

<p>This is no accident. In <a href="../3_Lists.1">Chapter 3</a> we saw that a list is a map defined by positional retrieval via item indexing. In <a href="../5_Dictionaries.1">Chapter 5</a> we saw that a dictionary is a map defined by key-value lookup. A function is a map defined by a sequence of expressions representing an algorithm for computing an output value from the input. The common notation is simply that of a map. It may take a little time to get accustomed to the Zen of q.</p>
<h3 id="652-list-of-indices-keys-and-arguments">6.5.2 List of Indices, Keys and Arguments<a class="headerlink" href="../6_Functions.1#652-list-of-indices-keys-and-arguments" title="Permanent link">&para;</a></h3>
<p>Just as we can use a list of indices to retrieve items from a list, so can dictionary lookup retrieve a list of values corresponding to a list of keys. And a list of arguments to an atomic function yields a list of outputs. This justifies the common notation.</p>
<pre><code class="q">q)L:10 20 30 40 50
q)L[2 5]
_
q)I:2 5
q)L I
_
q)d:`a`b`c!10 20 30
q)ks:`a`c
q)d ks
_
q)f[2 5]
_
q)f I
_
</code></pre>

<p>In fact, these are all examples of composition of maps.</p>
<pre><code class="txt">  I     L
--------------
0 |-&gt; 2 |-&gt; 4
1 |-&gt; 5 |-&gt; 25

  ks     d
---------------
0 |-&gt; `a |-&gt; 10
1 |-&gt; `c |-&gt; 30

  I     f
--------------
0 |-&gt; 2 |-&gt; 4
1 |-&gt; 5 |-&gt; 25
</code></pre>

<h3 id="653-indexing-at-depth">6.5.3 Indexing at Depth<a class="headerlink" href="../6_Functions.1#653-indexing-at-depth" title="Permanent link">&para;</a></h3>
<p>Next we examine the correspondence between indexing at depth and multivalent function evaluation. Notationally, a nested list is a list of lists, but it can also be viewed functionally as multivariate position retrieval. The display of a nested list tells us how: go down then over.</p>
<pre><code class="q">q)a:(1 2 3; 100 200)
q)a
1 2 3
100 200
q)a[1;0]
100
</code></pre>

<p>The first index goes down and the second index goes over. A more deeply nested list is a positional map whose valence is one greater than the depth of nesting.</p>
<p>Similarly, a dictionary with complex values can also be viewed as a multivariate map.</p>
<pre><code class="q">q)d:`a`b!(1 2 3; 100 200)
q)d[`a;1]
2
</code></pre>

<p>In this case, the first parameter locates a key and the second goes into the value list.</p>
<h3 id="654-projection-and-index-elision">6.5.4 Projection and Index Elision<a class="headerlink" href="../6_Functions.1#654-projection-and-index-elision" title="Permanent link">&para;</a></h3>
<p>You have no doubt noticed that the notations for function projection and elided indices in a list are identical. For example, an array is positional retrieval in which the first index is "down" and the second is "over." Thus eliding the first index indeed results in a list in which the remaining index is simply ordinary positional retrieval.</p>
<pre><code class="q">q)m:(10 20 30; 100 200 300)
q)m
10 20 30
100 200 300
q)m[1;2]
_
q)L:m[;2]
q)L
_
q)L[1]
_
</code></pre>

<h3 id="655-out-of-bounds-index">6.5.5 Out of Bounds Index<a class="headerlink" href="../6_Functions.1#655-out-of-bounds-index" title="Permanent link">&para;</a></h3>
<p>Viewing a list as a map on an integer domain also motivates the behavior of item indexing in the case of an out of bounds index. In traditional languages, this would either result in some sort of uncaught error – the infamous indexing off the end of an array – or an exception.</p>
<p>By viewing a list as a function defined on a sub-domain of integers, it is reasonable to extend the domain of the function to all integers by assigning a null output value outside the proper domain. Here null means "missing value." As we have seen previously,</p>
<pre><code class="q">q)10 20 30 40[100]
0N
q)`a`b`c[-1]
`
q)(1.1; 1; `1)[3]
0n
</code></pre>

<p>The behavior for dictionaries is completely analogous.</p>
<pre><code class="q">q)d:`a`b`c!10 20 30
q)d[`x]
0N
</code></pre>

<h2 id="66-atomic-functions">6.6 Atomic Functions<a class="headerlink" href="../6_Functions.1#66-atomic-functions" title="Permanent link">&para;</a></h2>
<p>The characterization of q as a vector language arises from the fact that most of the built-in operations are atomic. We examine the notion of atomic functions in more detail. The application of an atomic function is characterized by the fact that it recurses into an argument's structure until it gets to atoms and then applies there. It does this without explicit loops or other control flow constructs.</p>
<h3 id="661-monadic-atomic-functions-and-map">6.6.1 Monadic Atomic Functions and "map"<a class="headerlink" href="../6_Functions.1#661-monadic-atomic-functions-and-map" title="Permanent link">&para;</a></h3>
<p>Atomic behavior is easiest to see with a monadic function.</p>
<pre><code class="q">q)neg 10
-10
q)neg 10 20 30
-10 -20 -30
q)neg (10 20 30; 40 50)
-10 -20 -30
-40 -50
q)neg `a`b`c!10 20 30
a| -10
b| -20
c| -30
q)neg `a`b`c!(10 20; 30 40 50; 60)
a| -10 -20
b| -30 -40 -50
c| -60
</code></pre>

<p>A consequence of this behavior is that the result of a monadic atomic function always has the same shape as its argument – i.e., the output conforms to the input.</p>
<p>A special case of this is that applying an atomic function to a list is the same as applying it to each item in the list, which is sometimes described as "atomic functions extend automatically to lists." Similar functionality is achieved with "foreach" in traditional languages and the higher-order function "map" in functional languages.</p>
<h3 id="662-dyadic-atomic-functions-and-zip">6.6.2 Dyadic Atomic Functions and zip<a class="headerlink" href="../6_Functions.1#662-dyadic-atomic-functions-and-zip" title="Permanent link">&para;</a></h3>
<p>Atomic behavior is more interesting for dyadic functions. A dyadic function can be atomic in either or both arguments. The first case can be thought of as a monadic atomic function if you fix the non-atomic argument – i.e. project the function. For example, <em>find</em> (<code>?</code>) is atomic in only its second argument since it consumes the entire first argument in its search.</p>
<pre><code class="q">q)10 20 30?10
0
q)10 20 30?10 20 30 40 50
0 1 2 3 3
q)(enlist 10)?10
0
q)10 20?10
0
q)10 20 30 40 50?10
0
</code></pre>

<p>The arithmetic, comparison and relation operators are all atomic in both operands. This leads to four cases for application:</p>
<ul>
<li>atom with atom</li>
<li>atom with list</li>
<li>list with atom</li>
<li>list with list</li>
</ul>
<p>In the last case, the two list operands must have the same length.</p>
<pre><code class="q">q)1+10
11
q)1+10 20 30
11 21 31
q)1 2 3+10
11 12 13
q)1 2 3+10 20 30
11 22 33
</code></pre>

<p>Similar behavior is achieved with "zip" in traditional and functional programming.</p>
<h3 id="663-creating-atomic-functions">6.6.3 Creating Atomic Functions<a class="headerlink" href="../6_Functions.1#663-creating-atomic-functions" title="Permanent link">&para;</a></h3>
<p>Brief meditation reveals that the composition of atomic functions is atomic. Hence, the guaranteed way to build your own atomic functions is to compose built-in atomic functions. First monadic.</p>
<pre><code class="q">q)f:{(x*x)+(2*x)-1}
q)f 0
-1
q)f til 10
-1 2 7 14 23 34 47 62 79 98
</code></pre>

<p>Now dyadic.</p>
<pre><code class="q">q)pyth:{sqrt (x*x)+y*y}
q)pyth[1; 1]
1.414214
q)pyth[1; 1 2 3]
1.414214 2.236068 3.162278
q)pyth[1 2 3; 1 2 3]
1.414214 2.828427 4.242641
</code></pre>

<p>You might ask how to get this behavior with a function that is not atomic. Timely question.</p>
<h2 id="67-adverbs">6.7 Adverbs<a class="headerlink" href="../6_Functions.1#67-adverbs" title="Permanent link">&para;</a></h2>
<p>Adverbs are higher-order functions that modify the behavior of functions for application on lists. The terminology derives from thinking of q operators as verbs. Proficiency in the use of adverbs is one skill that separates q pretenders from q contenders.</p>
<p>Not every function is atomic, but we may still want to apply it to individual items of a data structure without loopy code. Adverbs to the rescue.</p>
<h3 id="671-monadic-each">6.7.1 Monadic each<a class="headerlink" href="../6_Functions.1#671-monadic-each" title="Permanent link">&para;</a></h3>
<p>We have seen that an atomic function automatically applies to the atoms in a nested list.</p>
<pre><code class="q">q)neg (1 2 3; 4 5)
-1 -2 -3
-4 -5
</code></pre>

<p>Clearly a function that aggregates a list into an atom cannot be atomic since it collapses the list structure. In particular, aggregate functions operate only at the top level of a nested list.</p>
<pre><code class="q">q)count 10 20 30
_
q)count (10 20 30; 40 50)
_
</code></pre>

<p>Suppose instead that we want to count each of the two items in our nested list. This is precisely what the <code>each</code> adverb does. It modifies a monadic function so that it applies to each item in a list rather than to the list as a whole. When used infix, <code>each</code> follows the function after (required) whitespace.</p>
<pre><code class="q">q)count each (10 20 30; 40 50)
3 2
</code></pre>

<p>The nature of <code>each</code> as a higher-order function is more clearly revealed in its equivalent prefix form. This may look odd at first, but it shows that <code>each</code> takes a function and modifies its behavior by applying to each item in a list.</p>
<pre><code class="q">q)each[count] (10 20 30; 40 50)
3 2
</code></pre>

<div class="admonition note">
<p class="admonition-title">Each</p>
<p>The higher-order function <code>each</code> is similar to "foreach" in imperative languages and is called "map" in functional programming languages. It is one half of the famous map-reduce paradigm.</p>
</div>
<p>We could say informally that <code>each</code> makes a non-atomic function act atomically… at least at one level. For deeply nested lists, you need to iterate <code>each</code> to apply a function at deeper levels.</p>
<pre><code class="q">q)(count each) each ((1 2 3; 3 4); (100 200; 300 400 500))
3 2
2 3
q)each[each[count]] ((1 2 3; 3 4); (100 200; 300 400 500))
_
</code></pre>

<p>The effect of iterated <code>each</code> is perhaps most clearly observed when applied to a matrix, where successive higher-order applications cause the original function to be applied on another axis.</p>
<pre><code class="q">q)count (1 2 3; 10 20 30)
_
q)count each (1 2 3; 10 20 30)
_
q)(count each) each (1 2 3; 10 20 30)
</code></pre>

<p>You can use <code>each</code> with any monadic function, although it is redundant on atomic functions.</p>
<pre><code class="q">q)reverse &quot;live&quot;
&quot;evil&quot;
q)reverse (&quot;life&quot;; &quot;the&quot;; &quot;universe&quot;; &quot;and&quot;; &quot;everything&quot;)
_
q)reverse each (&quot;life&quot;; &quot;the&quot;; &quot;universe&quot;; &quot;and&quot;; &quot;everything&quot;)
_
q)neg each (1 2 3; 4 5)
_
</code></pre>

<p>It often arises that you want to convert a vector of length n to an n×1 matrix. You can do that with <code>enlist each</code> but <code>flip enlist</code> executes faster for large lists.</p>
<pre><code class="q">q)enlist each 1001 1002 1004 1003
1001
1002
1004
1003
q)flip enlist 1001 1002 1004 1003
_
</code></pre>

<h3 id="672-each-both">6.7.2 each-both <code>'</code><a class="headerlink" href="../6_Functions.1#672-each-both" title="Permanent link">&para;</a></h3>
<p>An atomic operator automatically applies to corresponding pairs of items when applied to lists of the same length.</p>
<pre><code class="q">q)1 2 3+10 20 30
11 22 33
</code></pre>

<p>The dyadic <em>join</em> operator <code>,</code> is not atomic since it consumes (copies of) both of its operands in their entirety when it concatenates.</p>
<pre><code class="q">q)&quot;abc&quot;,&quot;de&quot;
&quot;abcde&quot;
</code></pre>

<p>Suppose we want to join list items pair-wise. For example,</p>
<pre><code class="q">q)(&quot;abc&quot;; &quot;uv&quot;),'(&quot;de&quot;; &quot;xyz&quot;)
&quot;abcde&quot;
&quot;uvxyz&quot;
</code></pre>

<p>The adverb <em>each-both</em> <code>'</code> modifies a dyadic function (operator, verb) to apply pairwise to corresponding list items. Conventionally no whitespace should be between <code>'</code> and the function it modifies but this does not generate an error. In some programming languages, <em>each-both</em> is called "zip".</p>
<pre><code class="q">q)(&quot;abc&quot;; &quot;uv&quot;),'(&quot;de&quot;; &quot;xyz&quot;)
&quot;abcde&quot;
&quot;uvxyz&quot;
</code></pre>

<p>There is no effect when the arguments are atoms.</p>
<pre><code class="q">q)3,'4
3 4
</code></pre>

<p>A function modified by <em>each-both</em> has the usual properties of atomic dyadic functions. For example, you get a length error if arguments don't line up.</p>
<pre><code class="q">q)(&quot;abc&quot;; &quot;uv&quot;),'(&quot;de&quot;; &quot;xyz&quot;; &quot;uhoh&quot;)
'length
</code></pre>

<p>The modified function also extends an atom to match a list. You will see this idiom often. For example,</p>
<pre><code class="q">q)1,'10 20 30
1 10
1 20
1 30
q)1 2 3,'10
_
q)2#'(&quot;abcde&quot;; &quot;fgh&quot;; &quot;ijklm&quot;)
&quot;ab&quot;
&quot;fg&quot;
&quot;ij&quot;
</code></pre>

<p>If you are so inclined, you can use a function modified by <em>each-both</em> in prefix form. This is not common but can simplify things in functional form of queries (see <a href="../9_Queries_q-sql.1#912-functional-forms">§9.12</a>).</p>
<pre><code class="q">q),'[(&quot;abc&quot;; &quot;uv&quot;); (&quot;de&quot;; &quot;xyz&quot;)]
_
</code></pre>

<p>The idiom <code>,'</code> works fine for making a list of pairs from two simple lists but does not always work as expected with general lists. For example it loses the enlisting of the singleton in the following.</p>
<pre><code class="q">q)L1:(enlist `a; `b)
q)L2:1 2
q)L1,'L2
`a 1
`b 2
</code></pre>

<p>A reliable way to make a list of pairs from a pair of lists is:</p>
<pre><code class="q">q)flip (L1; L2)
,`a 1
`b 2
</code></pre>

<div class="admonition note">
<p class="admonition-title">Advanced</p>
<p>A nice example of <code>,'</code> arises when both operands are tables. Since a table is a list of records, it is possible to apply <code>,'</code> to tables with the same number of rows. The record dictionaries in each row are upserted, resulting in a sideways join of the tables, as in the following example.</p>
</div>
<pre><code class="q">q)t1:([] c1:1 2 3)
q)t2:([] c2:`a`b`c)
q)t1,'t2
c1 c2
-----
1  a
2  b
3  c
</code></pre>

<h3 id="673-each-left">6.7.3 each-left <code>\:</code><a class="headerlink" href="../6_Functions.1#673-each-left" title="Permanent link">&para;</a></h3>
<p>An atomic operator extends an atom in the right operand to match a list on the left.</p>
<pre><code class="q">q)1 2 3+10
_
</code></pre>

<p>The <em>each-left</em> adverb <code>\:</code> modifies a dyadic function so that it applies the second argument with each item of the first argument – for example, to append a string to each string in a list. We insert unnecessary whitespace around the modified function in the following example to make it more readable.</p>
<pre><code class="q">q)(&quot;abc&quot;; &quot;de&quot;; enlist &quot;f&quot;) ,\: &quot;&gt;&quot;
&quot;abc&gt;&quot;
&quot;de&gt;&quot;
&quot;f&gt;&quot;
</code></pre>

<p>Traditionally there is no space between the adverb and the function it modifies but this causes no error.</p>
<h3 id="674-each-right">6.7.4 each-right <code>/:</code><a class="headerlink" href="../6_Functions.1#674-each-right" title="Permanent link">&para;</a></h3>
<p>An atomic operator extends an atom in the left operand to match a list on the right.</p>
<pre><code class="q">q)10+1 2 3
_
</code></pre>

<p>The <em>each-right</em> adverb <code>/:</code> modifies a dyadic function so that it applies the first argument to each item of the second argument. For example, to prepend a string to each string in a list. Again we surround the modified function with unnecessary whitespace for readability.</p>
<pre><code class="q">q)&quot;&lt;/&quot; ,/: (&quot;abc&quot;; &quot;de&quot;; enlist &quot;f&quot;)
_
</code></pre>

<p>Composing the last two examples makes data XML-ey (say it aloud) without loops.</p>
<pre><code class="q">q)&quot;&lt;/&quot;,/:(&quot;abc&quot;; &quot;de&quot;; enlist &quot;f&quot;),\:&quot;&gt;&quot;
_
</code></pre>

<h3 id="675-cross-product">6.7.5 Cross Product<a class="headerlink" href="../6_Functions.1#675-cross-product" title="Permanent link">&para;</a></h3>
<p>A cross (Cartesian) product of two lists pairs each item on the left with each item on the right. If we compose <em>join</em> with <em>each-right</em> and <em>each-left</em>, we are almost there, except that there is an extra level of nesting, which we eliminate with the built-in <code>raze</code>.</p>
<pre><code class="q">q)1 2 3,/:\:10 20
1 10 1 20
2 10 2 20
3 10 3 20
q)raze 1 2 3,/:\:10 20
1 10
1 20
2 10
2 20
3 10
3 20
</code></pre>

<p>The built-in operator <code>cross</code> computes this cross product.</p>
<pre><code class="q">q)1 2 3 cross 10 20
_
</code></pre>

<p>Observe that we could alternatively compose <em>each-left</em> with <em>each-right</em> and would arrive at the transpose of the previous result.</p>
<pre><code class="q">q)raze 1 2 3,\:/:10 20
1 10
2 10
3 10
1 20
2 20
3 20
</code></pre>

<h3 id="676-over-for-accumulation">6.7.6 Over (<code>/</code>) for Accumulation<a class="headerlink" href="../6_Functions.1#676-over-for-accumulation" title="Permanent link">&para;</a></h3>
<p>The <em>over</em> adverb <code>/</code> is a higher-order function that provides the principle mechanism for recursion in q. In its simplest form it modifies a dyadic function to accumulate results over a list.</p>
<p>Suppose we want to add the first 10 natural numbers starting at 1. In imperative programming this requires control flow: initialize a result variable, establish a loop counter and then loop while adding into the result until the counter reaches the end of the list. In functional programming, simply declare that you want to accumulate starting with an initial value of the accumulator. No counters, no tests, no loop. You say "what" to do rather than "how" to do it.</p>
<p>Let's see this in q. For readability, we have included optional whitespace.</p>
<pre><code class="q">q)0 +/ 1 2 3 4 5 6 7 8 9 10
55
</code></pre>

<p>In this expression, we apply a compound operator formed from <code>+</code> modified by <em>over</em> <code>/</code>.</p>
<div class="admonition warning">
<p class="admonition-title">White space</p>
<p>There can be no whitespace between the function and <code>/</code>, due to <code>/</code> also being used to begin a comment.</p>
</div>
<p>The initial accumulator value is the left operand and the list to accumulate over is the right operand. Under the covers, each item of the list is progressively added into the accumulator, moving across the list until the end is reached. The final accumulated value is returned. In our example, 1 is added into the initial accumulator value of 0 to get 1; then 2 is added to this value to get 3; and so on until the end of the list. Just like old-fashioned imperative code, except you never see it. Here is an instrumented form of accumulating sum. It uses the <code>0N!</code> operator to display the accumulator <code>x</code> paired with the next input <code>y</code> before returning their sum.</p>
<pre><code class="q">q)addi:{0N!(x;y); x+y}
q)0 addi/ 1 2 3 4 5
0 1
1 2
3 3
6 4
10 5
15
</code></pre>

<p>Observe that as a higher-order function <code>/</code> takes a dyadic function and returns a related dyadic function. The operands of the modified function are no longer symmetric – i.e., the left operand is the initial accumulator value and the right operand is the list to be accumulated.</p>
<div class="admonition note">
<p class="admonition-title">over</p>
<p>In functional programming languages <em>over</em> is called <em>fold</em> or <em>reduce</em>. Along with <code>each</code> this completes the famous map-reduce paradigm.</p>
</div>
<p>Often the generality of specifying the initial value of the accumulator is unnecessary. In our summation example, we could initialize the accumulator with the first list item and then accumulate the remaining items. The syntax for this form encloses the modified function in parentheses and omits the initial accumulator.</p>
<pre><code class="q">q)(+/) 1 2 3 4 5 6 7 8 9 10
55
</code></pre>

<p>Another way to think of this is by representing the list in general form.</p>
<p>(1; 2; 3; 4; 5; 6; 7; 8; 9; 10)</p>
<p>Then <code>+/</code> effectively replaces the semi-colons with <code>+</code>, associated to the left.</p>
<p>A few notes about the alternate form of <em>over</em>.</p>
<ul>
<li>The parentheses are mandatory</li>
<li>The modified function in this form is monadic</li>
<li>This construct is actually k and not q. Don't tell anyone you are writing k.</li>
</ul>
<p>Both the monadic and dyadic forms can be written in prefix.</p>
<pre><code class="q">q)+/[0; 1 2 3 4 5 6 7 8 9 10]
_
q)+/[1 2 3 4 5 6 7 8 9 10]
_
</code></pre>

<p>The basic <em>over</em> pattern is powerful. Use various dyadic functions to obtain common aggregate operations.</p>
<pre><code class="q">q)(*/) 1 2 3 4 5 6 7 8 9 10 / product
3628800
q)(|/) 7 8 4 3 10 2 1 9 5 6 / maximum
10
q)(&amp;/) 7 8 4 3 10 2 1 9 5 6 / minimum
1
</code></pre>

<p>Common aggregates are given their own names in q.</p>
<table>
<thead>
<tr>
<th>aggregate</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+/</code></td>
<td><code>sum</code></td>
</tr>
<tr>
<td><code>*/</code></td>
<td><code>prd</code></td>
</tr>
<tr>
<td><code>|/</code></td>
<td><code>max</code></td>
</tr>
<tr>
<td><code>&amp;/</code></td>
<td><code>min</code></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Anyone with information about the location of the missing ‘o’ in <code>prd</code> please notify Kx.</p>
</div>
<p>The edge cases when the above aggregates are applied to empty lists are completely determined by the appropriate invariants. For example, for <code>|/</code> the following must hold for the join of any numeric lists L1 and L2.</p>
<p>max[L1,L2] = max[L1]|max[L2]</p>
<p>After a moment of meditation we realize that choosing either L1 or L2 to be an empty list of numeric type forces,</p>
<pre><code class="q">q)(|/) `long$()
-0W
q)(|/) `float$()
-0w
</code></pre>

<div class="admonition note">
<p class="admonition-title">Advanced</p>
<p>For those who know about such things, the above equation says that <code>|/</code> is a morphism from the free monoid of lists with concatenation <code>,</code> to the monoid of naturals with <code>|</code>. The edge case says the morphism preserves the identity. </p>
<p>Other edge cases are analogous.
<pre><code class="language-q">
q)(&amp;/) `long<span><span class="MathJax_Preview">()
0W
q)(+/) \`long</span><script type="math/tex">()
0W
q)(+/) \`long</script></span>()
_
q)(*/) `long$()
_
q)(,/) ()
_
</code></pre></p>
</div>
<p>Applying <code>,/</code> across a list concatenates the items, effectively eliminating the top level of nesting. If there is only one level of nesting, this flattens a list of lists to a plain list. The function <code>,/</code> goes by the descriptive name <code>raze</code>.</p>
<pre><code class="q">q)(,/)((1 2 3; 4 5); (100 200; 300 400 500))
1 2 3
4 5
100 200
300 400 500
q)raze ((1 2 3; 4 5); (100 200; 300 400 500))
_
</code></pre>

<div class="admonition note">
<p class="admonition-title">Monads</p>
<p>For those who know about monads, lists comprise a monad. In Haskell-speak, <code>each</code> serves as "fmap", <code>enlist</code> as "return" and <code>,/</code> as "join".</p>
</div>
<p>You can use your own function with either form of <em>over</em>. The modified function can even be used infix, even though your original function cannot.</p>
<pre><code class="q">q)f:{2*x+y}
q)100 f/ 1 2 3 4 5 6 7 8 9 10
_
q)(f/) 1 2 3 4 5 6 7 8 9 10
_
</code></pre>

<h3 id="677-more-over-iteration">6.7.7 More Over: Iteration<a class="headerlink" href="../6_Functions.1#677-more-over-iteration" title="Permanent link">&para;</a></h3>
<p>The next pattern of recursion we investigate is another declarative equivalent of loopy code. In this version of <code>/</code>, the left operand is a natural number indicating how many times to perform the iteration and the right operand is the initial value.</p>
<p>Let's compute the n<sup>th</sup> Fibonacci number – see <a href="../1_Q_Shock_and_Awe.1#112-example-fibonacci-numbers">§1.12</a> for a more detailed derivation of <code>fib</code>. Again the modified function can be used infix or prefix.</p>
<pre><code class="q">q)fib:{x,sum -2#x}
q)10 fib/ 1 1
1 1 2 3 5 8 13 21 34 55 89 144
q)fib/[10; 1 1]
_
</code></pre>

<p>Yet another version of <code>/</code> runs the recursion until convergence, or until a loop is detected. Our example uses a simple form of Newton-Raphson – see <a href="../1_Q_Shock_and_Awe.1#113-example-newtons-method-for-nth-roots">§1.13</a> for a detailed exposition for n<sup>th</sup> roots. In this section we illustrate a variation of the square root in which we use a numerical approximation for the derivative. The approximation is the slope of the secant through points an epsilon to the left and right of <em>x</em>. This works provided we make epsilon sufficiently small because the derivative is defined as the slope of the tangent, which is the limit of the slope of the secant as epsilon approaches 0. Recall that in order to compute the square root of 2, we find the zero of <code>{-2+x*x}</code>.</p>
<pre><code class="q">q)f:{-2+x*x}
q)secant:{[f;x;e] (f[x+e]-f x-e)%2*e}
q){x-f[x]%secant[f; x; 1e-6]}/[1.5]
1.414214
</code></pre>

<p>How does q determine convergence? At each step the result is compared to that of the previous step. If the two agree within equality tolerance (10<sup>-14</sup> at the time of this writing – Sep 2015) the algorithm is considered to have converged and the recursion is complete; otherwise it continues.</p>
<p>Mathematically, it is possible to generate an infinite loop with Newton-Raphson. To wit, we select the function <em>x</em><sup>3</sup> – 2<em>x</em> + 2 and choose the initial value 0, which causes the algorithm to go into a cycle.</p>
<pre><code class="q">q)newtcycle:{[xn] xn-((xn*xn*xn)+(-2*xn)+2)%-2+3*xn*xn}
q)newtcycle/[0.0]
1f
</code></pre>

<p>How did q detect the cycle and stop the iteration? At each step it compares the result with the initial value. If they match, a cycle has occurred and the recursion is halted; otherwise it continues. Note that we mean "match" literally as in the <code>~</code> operator.</p>
<div class="admonition warning">
<p class="admonition-title">Open loops</p>
<p>If the values are equal but of different type, no cycle is detected and the loop will continue. In our example, providing a non-float initial value will cause an infinite loop. You will have to kill your console session if you enter the following.</p>
<p><pre><code class="language-q">
q)newtcycle/[0] / oops
</code></pre></p>
</div>
<p>The final overload of <code>/</code> is equivalent to a "while" loop in imperative programming. It provides a declarative way to specify a test to end the iteration. Thinking functionally, we provide a predicate function that is applied to the result at each step. The iteration continues as long as the predicate result is <code>1b</code> and stops otherwise. For example, we stop the computation of the Fibonacci sequence once it exceeds 1000 as follows.</p>
<pre><code class="q">q)fib:{x,sum -2#x}
q)fib/[{1000&gt;last x}; 1 1]
1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597
</code></pre>

<h3 id="678-scan">6.7.8 Scan <code>\</code><a class="headerlink" href="../6_Functions.1#678-scan" title="Permanent link">&para;</a></h3>
<p>The <em>scan</em> adverb <code>\</code> is a higher-order function that behaves just like <code>/</code> except that it returns all the intermediate accumulations instead of just the final one. Whereas <em>over</em> produces an aggregate function that collapses a list, <em>scan</em> produces a function whose output has the same number of items as its input – i.e., a <em>uniform</em> function. Informally, <em>scan</em> is a "running" version of <em>over</em>.</p>
<p>We omit optional whitespace in the following so that you can get accustomed to reading "real q."</p>
<pre><code class="q">q)0+\1 2 3 4 5 6 7 8 9 10
1 3 6 10 15 21 28 36 45 55
q)(*\)1 2 3 4 5 6 7 8 9 10
_
q)(|\)7 8 4 3 10 2 1 9 5 6
_
q)(&amp;\)7 8 4 3 10 2 1 9 5 6
_
q)100 f\1 2 3 4 5 6 7 8 9 10
_
q)(f\)1 2 3 4 5 6 7 8 9 10
_
</code></pre>

<p>All the variations of <em>over</em> are also available with <em>scan</em>. Switching to <em>scan</em> can be useful to see intermediate results of an accumulation. For example, we can see how fast Newton-Raphson converges to the square root by setting the float display to unlimited precision and running <em>scan</em>.</p>
<pre><code class="q">q)newtsqrt[1.0]
q)\P 0
q)newtsqrt[1.0]
1 1.5 1.4166666666666667 1.4142156862745099 1.4142135623746899
1.4142135623730951
</code></pre>

<h3 id="679-each-previous">6.7.9 each-previous (':)<a class="headerlink" href="../6_Functions.1#679-each-previous" title="Permanent link">&para;</a></h3>
<p>The adverb <em>each-previous</em> <code>':</code> provides a declarative way to perform a dyadic operation on each item of a list with its predecessor.</p>
<div class="admonition tip">
<p class="admonition-title">Operands</p>
<p>During traversal of the list, the current item is the left operand and the previous item is the right operand.</p>
</div>
<p>Since the initial item of the list does not have a predecessor, we must provide one in the left operand of the modified operator. One choice is the initial item of the source list. For example, to calculate the deltas of a list of prices.</p>
<pre><code class="q">q)100 -': 100 99 101 102 101
0 -1 2 1 -1
</code></pre>

<p>As with the other adverbs, there is a monadic form of <em>each-previous</em> (technically, it is k). It may come as a surprise that the monadic form does <strong>not</strong> choose the initial item of the input list as the initial predecessor. Rather, it returns the initial item of the input on <code>-</code> and <code>%</code>.</p>
<pre><code class="q">q)(-':)100 99 101 102 101
100 -1 2 1 -1
q)deltas 100 99 101 102 101
100 -1 2 1 -1
q)(%':)100 99 101 102 101
100 0.98999999999999999 1.0202020202020201 1.0099009900990099 0.99019607843137258
q)ratios 100 99 101 102 101
_
</code></pre>

<p>The motivation is that the initial predecessor is implicitly chosen as the identity for the dyadic function (assuming such exists). This has the advantage of preserving desirable invariants.</p>
<pre><code class="q">q)sums deltas 100 99 101 102 101
100 99 101 102 101
q)deltas sums 100 99 101 102 101
_
</code></pre>

<p>On the other hand, if you are looking for anomalies in absolute differences – e.g., price changes – you will get a nasty surprise.</p>
<pre><code class="q">q)deltas 100 99 101 102 101
100 -1 2 1 -1
</code></pre>

<p>It is easy enough to make our own version for this case.</p>
<pre><code class="q">q)deltas0:{first[x] -': x}
q)deltas0 100 99 101 102 101
0 -1 2 1 -1
</code></pre>

<p>A powerful idiom with <em>each-previous</em> uses <em>match</em> <code>~</code> to test if successive items are identical. It is actually more useful to know where they do not match; the latter is built in as <a href="http://code.kx.com/q/ref/comparison/#differ"><code>differ</code></a>.</p>
<pre><code class="q">q)(~':) 1 1 1 2 2 3 4 5 5 5 6 6
011010001101b
q)not (~':) 1 1 1 2 2 3 4 5 5 5 6 6
100101110010b
q)differ 1 1 1 2 2 3 4 5 5 5 6 6
_
</code></pre>

<p>Observe that the <code>1b</code> values in the result of <code>differ</code> are the start points for runs of identical items, so <code>where</code> yields their indices. Then use <code>cut</code> to split them out.</p>
<pre><code class="q">q)L:1 1 1 2 2 3 4 5 5 5 6 6
q)where differ L
0 3 5 6 7 10
q)(where differ L) cut L
1 1 1
2 2
,3
,4
5 5 5
6 6
</code></pre>

<p>Now let's do some q.</p>
<pre><code class="q">q)runs:(where differ L) cut L / store runs
q)ct:count each runs / store count of each run
q)runs where ct=max ct / find the runs of maximum length
1 1 1
5 5 5
</code></pre>

<p>While some q coders don't like the style, we point out that the above can be written in a single line of q using intra-line assignments.</p>
<pre><code class="q">q)runs where ct=max ct:count each runs:(where differ L) cut L
_
</code></pre>

<p>Using comparison and the correct initial value, we can also use the above technique to find runs of increasing or decreasing values.</p>
<pre><code class="q">q)L:9 8 7 11 10 12 13
q)(where -0W&gt;':L) cut L
9 8 7
11 10
,12
,13
q)(where 0W&lt;':L) cut L
,9
,8
7 11
10 12 13
</code></pre>

<p>This is the <em>raison d'être</em> for integer infinities.</p>
<h2 id="68-general-application">6.8 General Application<a class="headerlink" href="../6_Functions.1#68-general-application" title="Permanent link">&para;</a></h2>
<p>We have seen that the syntactic forms of list indexing, key lookup and function application can use either square brackets or juxtaposition.</p>
<pre><code class="q">q)L:(1 2;3 4 5; enlist 6)
q)L[0]
_
q)L 1
_
q)L[0 2]
_
q)L[1][2]
_
q)L[1; 2]
_
q)d:`a`b`c!(1 2; 3 4 5; enlist 6)
q)d[`a]
1 2
q)d `a
_
q)d[`a`c]
_
q)d[`a][1]
_
q)d[`a; 1]
_
q)f:{x*x}
q)f[0]
_
q)f 1
_
q)f[0 2]
_
q)g:{x+y}
q)g[1][2]
_
q)g[1;2]
)
</code></pre>

<p>It turns out that both forms are syntactic sugar for how q actually treats application. You won't be surprised that application is actually a higher-order function that takes a function and value(s) and evaluates the function at the value(s). Thorough understanding of the general application is another test that separates the q pretenders from the contenders. The simpler forms of general application are usually written infix and are traditionally considered to be verbs.</p>
<h3 id="681-verb">6.8.1 Verb @<a class="headerlink" href="../6_Functions.1#681-verb" title="Permanent link">&para;</a></h3>
<p>Basic application comprises retrieving a list item by index, looking up a dictionary value by key, or evaluating a monadic function. These are all instances of application of a univalent mathematical mapping. These are to be distinguished from indexing at depth, which is discussed in the next section.</p>
<p>The higher-order function <code>@</code> is the true form of basic application in q. It applies a monadic mapping to an argument. As with all built-in functions, it can be written infix or prefix.</p>
<pre><code class="q">q)10 20 30 40@1
20
q)L:10 20 30 40
q)L@1
_
q)@[L; 1]
_
q)count@L
_
q)@[count; L]
_
q){x*x}@L
_
q)d:`a`b`c!10 20 30
q)d@`a
_
q)@[d;`b]
_
</code></pre>

<p>Applying a niladic function with <code>@</code> is best done using the nil argument <code>::</code> but any argument suffices since it is ignored.</p>
<pre><code class="q">q)f:{6*7}
q)f[]
_
q)@[f; ::]
_
q)f@(::)
_
q)f@43
42
</code></pre>

<p>For contrast with vector application in the next section, we collect previously discussed facts about ordinary application with a non-atom argument.</p>
<ul>
<li>For lists, dictionaries and atomic functions, <code>@</code> application yields an output that conforms to the shape of the input.</li>
<li>An aggregate function collapses the top level of nesting from the input.</li>
<li>A uniform function has output the same length as an input list.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Advanced</p>
<p>The function <code>@</code> also applies to tables and keyed tables since they are lists and dictionaries, respectively. Since a table is a list of records, using <code>@</code> retrieves records; for dictionaries and keyed tables it looks up keys:</p>
</div>
<pre><code class="q">q)t:([]c1:1 2 3; c2:`a`b`c)
q)t@1
c1| 2
c2| `b
q)d:`a`b`c!10 20 30
q)d@`b
_
q)kt:([k:`a`b`c] v:1.1 2.2 3.3)
q)kt@`c
v| 3.3
</code></pre>

<h3 id="682-verb-dot">6.8.2 Verb Dot <code>.</code><a class="headerlink" href="../6_Functions.1#682-verb-dot" title="Permanent link">&para;</a></h3>
<p>Indexing a list at depth, retrieving a nested value from a dictionary and evaluating a function with multiple parameters are all instances of applying a multi-variate mapping. The higher-order function <code>.</code> is the true form of multi-variate application in q. It applies a multi-variate mapping to multiple arguments and can be written infix or prefix.</p>
<div class="admonition note">
<p class="admonition-title">Important</p>
<p>The right argument of <code>.</code> must be a list.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">White space</p>
<p>Separate verb <code>.</code> from its operands by whitespace if they are names or literal constants, as proximity to dots used in name spacing and in decimal numbers can lead to confusion.</p>
</div>
<p>Here we show various forms of indexing at depth rewritten with <code>.</code>.</p>
<pre><code class="q">q)L:(10 20 30; 40 50)
q)L[1][0]
40
q)L[1; 0]
_
q)L . 1 0
_
q)d:`a`b`c!(10 20 30; 40 50; enlist 60)
q)d[`b][0]
40
q)d[`b; 0]
_
q)d . (`b; 0)
_
q)g:{x+y}
q)g[1; 2]
_
q)g . 1 2
_
</code></pre>

<p>Observe that verb <em>dot</em> effectively allows us to apply a multi-variate function to a list of arguments instead of multiple individual arguments. Mathematically, this means that we are thinking of the function as defined on a vector instead of its individual components.</p>
<p>Dot application provides function application syntax that is conveniently independent of the valence of the function. This is useful for situations in which a function and its arguments are generated dynamically – e.g., dynamic dispatch – and the valence cannot be known in advance.</p>
<pre><code class="q">q)g:{x+y}
q)f:g
q)f . 1 2
_
q)h:{x+y+z}
q)f:h
q)f . 1 2 3
_
</code></pre>

<p>You can apply a monadic function with <code>.</code>. The insight is that a function of a scalar is inter-convertible with a function of a singleton vector. This is realized in q if you enlist the argument and use <code>.</code> for application.</p>
<pre><code class="q">q)f:{x*x}
q)f@5
_
q)f . enlist 5
_
q)f . enlist 1 2 3
1 4 9
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Advanced</p>
<p>We conclude that <code>.</code> can apply a function of any valence and that <code>@</code> is actually unnecessary. Most q programmers do use <code>@</code> where applicable (pun intended).</p>
</div>
<p>To denote an elided index with <code>.</code> application, use the nil item.</p>
<pre><code class="q">q)m:(1 2 3;4 5 6)
q)m[0;]
_
q)m . (0; ::)
_
q)m . (::; 1)
_
</code></pre>

<p>Evaluating a niladic function with <code>.</code> should properly use the enlisted nil item, although any enlisted value will suffice since it is ignored.</p>
<pre><code class="q">q)f:{6*7}
q)f . enlist (::)
_
q)f . enlist 42
_
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Advanced</p>
<p>Let’s climb the philosophical mountain. All data structures in q are composed from lists and dictionaries. Because q views both lists and dictionaries as mathematical mappings, retrieval from each is function application. Retrieval from un-nested lists and dictionaries is monadic application with <code>@</code>. Retrieval from nested entities is multivariate application with <code>.</code>. In light of the previous observation that a monadic function can be viewed as a function on a singleton vector, the function <code>.</code> provides a mechanism for retrieval from an arbitrary data structure. Gazing out from the summit, we see that all application is actually <code>.</code>.</p>
</div>
<p>Following are some examples of complex data structures and indexing at depth. See if you can predict them before entering at the console. (They make good q test questions)</p>
<pre><code class="q">q)L:10 20 30
q)L . enlist 1
_
q)m:(10 20 30; 100 200 300)
q)m . 0 1
_
q)ds:(`a`b`c!10 20 30; `x`y!100 200)
q)ds . (0; `b)
_
q)mix:(10 20 30; `a`b`c!(1; 2; (300 400)))
q)mix . (1; `c; 1)
_
q)dc:`c1`c2!(1 2 3; `a`b`c)
q)dc . (`c2; 1)
_
q)t:([]c1:1 2 3;c2:`a`b`c)
q)t . (1; `c2)
_
</code></pre>

<p>And for keyed tables (see <a href="../8_Tables.1#84-primary-keys-and-keyed-tables">§8.4</a>).</p>
<pre><code class="q">q)kt:([k:`a`b`c] v:1.1 2.2 3.3)
q)kt . `b`v
_
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Indexing at depth</p>
<p>Note that indexing at depth fails for accessing items inside a nested column.
<pre><code class="language-q">
q)t:([] c1:`a`b`c; c2:(1 2; 100 200 400; enlist 1000))
q)t . (1; `c2)
100 200 400
q)t . (1; `c2; 1)
'rank
</code></pre>
(Until V3.5, that is. <em>Ed.</em>)
<pre><code class="language-q">
q)t . (1; `c2; 1)
200
</code></pre></p>
</div>
<h3 id="683-general-form-of-verb-application">6.8.3 General Form of Verb Application<a class="headerlink" href="../6_Functions.1#683-general-form-of-verb-application" title="Permanent link">&para;</a></h3>
<p>The uses of <code>@</code> and <code>.</code> seen heretofore are actually special cases of more general higher-order functions of greater valence. Since these must be written prefix, we begin by writing some simple examples of verb application from the previous section into prefix form. We use lists for simplicity but other data structures are also applicable.</p>
<pre><code class="q">q)L:10 20 30 40 50
q)@[L; 1]
20
q)@[L; 0 2]
10 30
q)m:(10 20 30; 100 200 300)
q).[m; 0 2]
30
</code></pre>

<p>Each application above can be viewed as <strong>retrieval</strong> from the data structure along a sub-domain of its definition. From this perspective, the general forms to come will apply an <strong>arbitrary operation</strong> along a sub-domain. Otherwise said, they modify a substructure <strong>within</strong> the original structure. This is a very powerful technique that is not present in traditional programming languages.</p>
<h3 id="684-general-apply-with-monadic-functions">6.8.4 General Apply (@) with Monadic Functions<a class="headerlink" href="../6_Functions.1#684-general-apply-with-monadic-functions" title="Permanent link">&para;</a></h3>
<p>We restate the <code>@</code> retrieval examples from the previous section.</p>
<pre><code class="q">q)L:10 20 30 40 50
q)@[L; 1]
20
q)@[L; 0 2]
10 30
</code></pre>

<p>Now instead of simply retrieving along the sub-domain, we supply a function to be <strong>applied</strong> along the sub-domain.</p>
<pre><code class="q">q)@[L; 1; neg]
10 -20 30 40 50
q)@[L; 0 2; neg]
-10 20 -30 40 50
</code></pre>

<p>Effectively we reach inside (a copy of) the list, apply <code>neg</code> along the specified sub-domain, and return the modified list. Contrast this with normal application on the sub-domain, which returns only the modified items.</p>
<pre><code class="q">q)neg L@0 1
-10 -20
</code></pre>

<p>The significance of enhanced application is that it returns the entire modified list, which allows the result to be chained (i.e., composed) into further operations. If you don't think this is a big deal, think again.</p>
<p>The syntax for general application of a monadic atomic function on a list is,</p>
<pre><code class="q">@[L;I;f]
</code></pre>

<p>where <code>L</code> is the list and <code>I</code> is a collection of indices into <code>L</code>. Viewing <code>L</code> as a mapping, <code>I</code> is a top-level sub-domain of <code>L</code>. In fact, this form generalizes to any data structure viewed as a mapping. For example, given a dictionary and a list of keys,</p>
<pre><code class="q">q)d:`a`b`c!10 20 30
q)ks:`a`c
q)@[d; ks; neg]
a| -10
b| 20
c| -30
</code></pre>

<div class="admonition note">
<p class="admonition-title">Compound data structures</p>
<p>For compound data structures such as nested lists, tables and keyed tables, application of <code>@</code> occurs along a sub-domain at the top level. We'll see how to reach down into data structure in the next section.
<pre><code class="language-q">
q)m:(10 20 30; 100 200 300; 1000 2000 3000)
q)@[m; 0 2; neg]
-10 -20 -30
100 200 300
-1000 -2000 -3000
</code></pre></p>
</div>
<p>All the examples we have shown thus far work against copies of the input data structure. It is also possible to modify the original data structure in place. Although q does not have references, general application provides pass-by-name with the name being a symbol. We demonstrate with a simple example. In the first application, the original <code>L</code> is unchanged; in the second it is modified.</p>
<pre><code class="q">q)L:10 20 30 40
q)@[L; 0; neg]
-10 20 30 40
q)L
10 20 30 40
q)@[`L; 0 ; neg]
`L
q)L
-10 20 30 40
</code></pre>

<p>Observe that the result of an application of pass-by-name is the passed symbolic name. This allows chaining of function applications that modify in place.</p>
<h3 id="685-general-apply-with-dyadic-functions">6.8.5 General Apply (<code>@</code>) with Dyadic Functions<a class="headerlink" href="../6_Functions.1#685-general-apply-with-dyadic-functions" title="Permanent link">&para;</a></h3>
<p>In the previous section we saw how to apply a <strong>monadic</strong> function within the top level of a data structure. In the same way, we can apply a dyadic atomic function using <code>@</code> by providing the function together with an operand to apply along the sub-domain. Clearly the shape of the supplied operand must conform to the specified sub-domain. The exception is applying with an atom, in which case the latter is automatically extended to match the sub-domain.</p>
<pre><code class="q">q)L:10 20 30 40
q)@[L; 0 1; +; 100 200]
110 220 30 40
q)@[L; 0 1; +; 100]
_
q)d:`a`b`c!10 20 30
q)@[d; `a`b; +; 100 200]
a| 110
b| 220
c| 30
q)@[d; `a`b; +; 100]
_
</code></pre>

<p>The general form of functional <code>@</code> for a dyadic atomic function is,</p>
<pre><code class="q">@[L; I; g; v]
</code></pre>

<p>The notation is suggestive of lists, but L can be any data structure, viewed as a mapping. Here <code>I</code> is a top-level sub-domain of <code>L</code>; <code>g</code> is a dyadic function; and <code>v</code> is an atom or list conforming to <code>I</code>.</p>
<p>We contrast application along a sub-domain with normal application on the extracted substructure.</p>
<pre><code class="q">q)L:10 20 30 40
q)@[L; 0 1; +; 100 200]
110 220 30 40
q)100 200+L@0 1
110 220
</code></pre>

<p>As in the monadic case, application of <code>@</code> along a sub-domain of compound data structures (e.g., nested lists, tables and keyed tables) occurs at the top Level.</p>
<pre><code class="q">q)m:(10 20 30; 100 200 300; 1000 2000 3000)
q)@[m; 0 2; +; 1 2]
11 21 31
100 200 300
1002 2002 3002
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A useful case of dyadic application uses the assignment operator <code>:</code> to modify values along the sub-domain.
<pre><code class="language-q">
q)L:10 20 30 40
q)@[L; 0 2; :; 42 43]
42 20 43 40
</code></pre></p>
</div>
<p>As in the monadic case, to apply to the original in place, instead of to a copy, use pass-by-name.</p>
<pre><code class="q">q)L:10 20 30 40
q)@[`L; 0 2; :; 42 43]
`L
q)L
42 20 43 40
</code></pre>

<h3 id="686-general-apply-for-monadic-functions">6.8.6 General Apply (<code>.</code>) for Monadic Functions<a class="headerlink" href="../6_Functions.1#686-general-apply-for-monadic-functions" title="Permanent link">&para;</a></h3>
<p>We have seen that general <code>@</code> applies a function on a vector along the top level of a data structure. Now consider indexing at depth.</p>
<div class="admonition tip">
<p class="admonition-title">Be normal</p>
<p>Although the construct is valid at any depth, there is a case to be made for not going beyond depth two in q (i.e., data normalization with tables).</p>
</div>
<p>We begin by restating simple examples of indexing at depth in prefix notation, using moderately nested lists and dictionaries for simplicity.</p>
<pre><code class="q">q)m:(10 20 30; 100 200 300)
q).[m; 0 1]
20
q)d:`a`b`c!(10 20 30; 40 50; enlist 60)
q).[d; (`a; 1)]
20
</code></pre>

<p>In contrast with <code>@</code>, the vector argument of <code>.</code> reaches down into the data structure and picks out a single point in the domain. Here we target that point with a monadic function.</p>
<pre><code class="q">q).[m; 0 1; neg]
10 -20 30
100 200 300
q).[d; (`a; 1); neg]
a| 10 -20 30
b| 40 50
c| ,60
</code></pre>

<p>As before, these applications work against a copy of the data. To modify the original in place, <code>.</code> supports pass-by-name.</p>
<pre><code class="q">q).[m; 0 1; neg]
q)m
_
q).[`m; 0 1; neg]
`m
q)m
_
q).[d; (`a; 1); neg]
_
q)d
_
q).[`d; (`a; 1); neg]
`d
q)d
_
</code></pre>

<p>We previously saw that to elide an index in <code>.</code> retrieval, we place the nil item <code>::</code> in that slot. The same holds for general application, where it means apply the function along <strong>all</strong> indices at that level.</p>
<pre><code class="q">q).[m; (0; ::); neg]
-10 -20 -30
100 200 300
q)d:`a`b`c!(100 200 300; 400 500; enlist 600)
q).[d; (`a; ::); neg]
a| -100 -200 -300
b| 400 500
c| ,600
q).[d; (::; 0); neg]
a| -100 200 300
b| -400 500
c| ,-600
</code></pre>

<p>The general form of <code>.</code> for monadic functions is,</p>
<pre><code class="q">.[L; I; f]
</code></pre>

<p>Here <code>L</code> is a data structure, <code>I</code> is an in-depth sub-domain of <code>L</code> and <code>f</code> is a monadic atomic function.</p>
<h3 id="687-general-apply-for-dyadic-functions">6.8.7 General Apply (<code>.</code>) for Dyadic Functions<a class="headerlink" href="../6_Functions.1#687-general-apply-for-dyadic-functions" title="Permanent link">&para;</a></h3>
<p>By now you can predict how general application <code>.</code> with a dyadic function works. The form of functional <code>.</code> for a dyadic function is,</p>
<pre><code class="q">.[L; I; g; v]
</code></pre>

<p>Here <code>L</code> is a data structure, <code>I</code> is an in-depth sub-domain of <code>L</code>, <code>g</code> is a dyadic function and <code>v</code> is an atom (for <code>g</code> atomic) or a vector that conforms to <code>I</code>. To apply in place use pass-by-name.</p>
<pre><code class="q">q)m:(10 20 30; 100 200 300)
q).[m; 0 1; +; 1]
10 21 30
100 200 300
q).[m; (::; 1); +; 1 2]
10 21 30
_
q)m
_
q).[`m; (::; 1); +; 1]
_
q)m
_
q).[`m; (::; 1); :; 42]
`m
q)m
_
q)d:`a`b`c!(100 200 300; 400 500; enlist 600)
q).[d; (`a; 1); +; 1]
_
q).[d; (`a; ::); +; 1]
_
q).[d; (::; 0); +; 1]
_
q)d
_
q).[`d; (::; 0); :; 42]
_
q)d
_
</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../5_Dictionaries.1" title="5. Dictionaries" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                5. Dictionaries
              </span>
            </div>
          </a>
        
        
          <a href="../7_Transforming_Data/index.html" title="7. Transforming Data" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                7. Transforming Data
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2015 Jeffry A. Borror / q4m LLC. Kx® and kdb+ are registered trademarks of Kx Systems, Inc., a subsidiary of First Derivatives plc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
      
        <script src="https://tracker.mrpfd.com/tracker.js"></script>
      
        <script src="http://code.kx.com/scripts/googleanalytics.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://use.fontawesome.com/3dbf29ed12.js"></script>
      
        <script src="http://code.kx.com/scripts/prism.js"></script>
      
    
    
      
    
  </body>
</html>